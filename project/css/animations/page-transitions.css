/**
 * Page Transitions CSS
 * Styles for page transition overlay effects
 * 
 * Requirements:
 * - 3.1: Liquid wipe effect with clip-path animation
 * - 3.3: Gradient background from primary colors (#667eea, #764ba2, #f093fb, #fa709a)
 * - 3.5: Alternative curtain reveal effect with 5 panels
 * - 1.1-1.3: GPU acceleration (transform, opacity, will-change)
 * - 9.1-9.4: Reduced motion support (@media prefers-reduced-motion)
 * 
 * Design Reference:
 * - Duration: 800ms
 * - Easing: cubic-bezier(0.77, 0, 0.175, 1)
 * - Liquid wipe: clip-path circle animation from 0% to 150%
 * - Curtain reveal: 5 panels with scaleY transform
 * 
 * @module css/animations/page-transitions
 */

/* ==========================================================================
   CSS Custom Properties for Page Transitions
   ========================================================================== */

:root {
    /* Transition gradient colors - Requirement 3.3 */
    --transition-color-blue: #667eea;
    --transition-color-purple: #764ba2;
    --transition-color-pink: #f093fb;
    --transition-color-coral: #fa709a;
    
    /* Transition timing - Requirement 3.2 */
    --transition-duration: 800ms;
    --transition-easing: cubic-bezier(0.77, 0, 0.175, 1);
    
    /* Curtain panel settings */
    --curtain-panel-count: 5;
    --curtain-stagger-delay: 50ms;
    
    /* Z-index for overlay */
    --transition-z-index: 9999;
}

/* ==========================================================================
   Base Overlay Styles
   Common styles for all transition overlays
   ========================================================================== */

.page-transition-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: var(--transition-z-index);
    pointer-events: none;
    
    /* GPU acceleration - Requirements 1.1, 1.2, 1.3 */
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

/* ==========================================================================
   Liquid Wipe Overlay
   Requirements: 3.1, 3.3 - Liquid wipe with clip-path and gradient
   ========================================================================== */

.page-transition-overlay--liquid {
    /* Gradient background - Requirement 3.3 */
    background: linear-gradient(
        135deg,
        var(--transition-color-blue) 0%,
        var(--transition-color-purple) 25%,
        var(--transition-color-pink) 75%,
        var(--transition-color-coral) 100%
    );
    
    /* Initial state - circle at 0% */
    clip-path: circle(0% at 50% 50%);
    
    /* Transition for clip-path animation - Requirement 3.2 */
    transition: clip-path var(--transition-duration) var(--transition-easing);
    
    /* GPU acceleration for smooth clip-path animation */
    will-change: clip-path;
}

/* Liquid wipe active state - expands to cover entire viewport */
.page-transition-overlay--liquid.page-transition-overlay--active,
.page-transition-active .page-transition-overlay--liquid {
    clip-path: circle(150% at 50% 50%);
    pointer-events: all;
}

/* Alternative liquid wipe from different positions */
.page-transition-overlay--liquid.page-transition-overlay--from-top {
    clip-path: circle(0% at 50% 0%);
}

.page-transition-overlay--liquid.page-transition-overlay--from-top.page-transition-overlay--active {
    clip-path: circle(200% at 50% 0%);
}

.page-transition-overlay--liquid.page-transition-overlay--from-bottom {
    clip-path: circle(0% at 50% 100%);
}

.page-transition-overlay--liquid.page-transition-overlay--from-bottom.page-transition-overlay--active {
    clip-path: circle(200% at 50% 100%);
}

.page-transition-overlay--liquid.page-transition-overlay--from-left {
    clip-path: circle(0% at 0% 50%);
}

.page-transition-overlay--liquid.page-transition-overlay--from-left.page-transition-overlay--active {
    clip-path: circle(200% at 0% 50%);
}

.page-transition-overlay--liquid.page-transition-overlay--from-right {
    clip-path: circle(0% at 100% 50%);
}

.page-transition-overlay--liquid.page-transition-overlay--from-right.page-transition-overlay--active {
    clip-path: circle(200% at 100% 50%);
}

/* ==========================================================================
   Curtain Reveal Overlay
   Requirements: 3.3, 3.5 - Curtain reveal with 5 panels
   ========================================================================== */

.page-transition-overlay--curtain {
    display: flex;
    flex-direction: row;
    background: transparent;
}

/* Individual curtain panel */
.page-transition-overlay__panel {
    flex: 1;
    height: 100%;
    
    /* Initial state - scaled to 0 on Y axis */
    transform: scaleY(0);
    transform-origin: top center;
    
    /* Transition for scale animation - Requirement 3.2 */
    transition: transform var(--transition-duration) var(--transition-easing);
    
    /* GPU acceleration - Requirements 1.1, 1.2, 1.3 */
    transform-style: preserve-3d;
    backface-visibility: hidden;
    will-change: transform;
}

/* Panel gradient backgrounds - Requirement 3.3 */
.page-transition-overlay__panel:nth-child(1) {
    background: linear-gradient(
        180deg,
        var(--transition-color-blue) 0%,
        var(--transition-color-purple) 100%
    );
    transition-delay: 0ms;
}

.page-transition-overlay__panel:nth-child(2) {
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--transition-color-blue) 75%, var(--transition-color-purple) 25%) 0%,
        color-mix(in srgb, var(--transition-color-purple) 75%, var(--transition-color-pink) 25%) 100%
    );
    transition-delay: calc(var(--curtain-stagger-delay) * 1);
}

.page-transition-overlay__panel:nth-child(3) {
    background: linear-gradient(
        180deg,
        var(--transition-color-purple) 0%,
        var(--transition-color-pink) 100%
    );
    transition-delay: calc(var(--curtain-stagger-delay) * 2);
}

.page-transition-overlay__panel:nth-child(4) {
    background: linear-gradient(
        180deg,
        color-mix(in srgb, var(--transition-color-purple) 50%, var(--transition-color-pink) 50%) 0%,
        color-mix(in srgb, var(--transition-color-pink) 50%, var(--transition-color-coral) 50%) 100%
    );
    transition-delay: calc(var(--curtain-stagger-delay) * 3);
}

.page-transition-overlay__panel:nth-child(5) {
    background: linear-gradient(
        180deg,
        var(--transition-color-pink) 0%,
        var(--transition-color-coral) 100%
    );
    transition-delay: calc(var(--curtain-stagger-delay) * 4);
}

/* Fallback for browsers without color-mix support */
@supports not (background: color-mix(in srgb, red 50%, blue 50%)) {
    .page-transition-overlay__panel:nth-child(2) {
        background: linear-gradient(
            180deg,
            #6b72c4 0%,
            #9a5fb5 100%
        );
    }
    
    .page-transition-overlay__panel:nth-child(4) {
        background: linear-gradient(
            180deg,
            #b874d6 0%,
            #f59ec7 100%
        );
    }
}

/* Curtain panels active state - scale to full height */
.page-transition-overlay--curtain.page-transition-overlay--active .page-transition-overlay__panel,
.page-transition-active .page-transition-overlay--curtain .page-transition-overlay__panel {
    transform: scaleY(1);
}

/* Alternative curtain from bottom */
.page-transition-overlay--curtain.page-transition-overlay--from-bottom .page-transition-overlay__panel {
    transform-origin: bottom center;
}

/* Alternative curtain with horizontal panels */
.page-transition-overlay--curtain.page-transition-overlay--horizontal {
    flex-direction: column;
}

.page-transition-overlay--curtain.page-transition-overlay--horizontal .page-transition-overlay__panel {
    width: 100%;
    height: auto;
    flex: 1;
    transform: scaleX(0);
    transform-origin: left center;
    transition: transform var(--transition-duration) var(--transition-easing);
}

.page-transition-overlay--curtain.page-transition-overlay--horizontal.page-transition-overlay--active .page-transition-overlay__panel {
    transform: scaleX(1);
}

/* ==========================================================================
   Body Active State
   Applied to body during transition
   ========================================================================== */

.page-transition-active {
    /* Prevent scrolling during transition */
    overflow: hidden;
}

.page-transition-active::before {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: calc(var(--transition-z-index) - 1);
    pointer-events: all;
}

/* ==========================================================================
   Transition Exit Animation
   For when the new page loads
   ========================================================================== */

.page-transition-exit .page-transition-overlay--liquid {
    clip-path: circle(150% at 50% 50%);
    animation: liquid-wipe-exit var(--transition-duration) var(--transition-easing) forwards;
}

@keyframes liquid-wipe-exit {
    from {
        clip-path: circle(150% at 50% 50%);
    }
    to {
        clip-path: circle(0% at 50% 50%);
    }
}

.page-transition-exit .page-transition-overlay--curtain .page-transition-overlay__panel {
    transform: scaleY(1);
    animation: curtain-exit var(--transition-duration) var(--transition-easing) forwards;
}

@keyframes curtain-exit {
    from {
        transform: scaleY(1);
    }
    to {
        transform: scaleY(0);
    }
}

/* Staggered exit for curtain panels */
.page-transition-exit .page-transition-overlay__panel:nth-child(1) {
    animation-delay: calc(var(--curtain-stagger-delay) * 4);
}

.page-transition-exit .page-transition-overlay__panel:nth-child(2) {
    animation-delay: calc(var(--curtain-stagger-delay) * 3);
}

.page-transition-exit .page-transition-overlay__panel:nth-child(3) {
    animation-delay: calc(var(--curtain-stagger-delay) * 2);
}

.page-transition-exit .page-transition-overlay__panel:nth-child(4) {
    animation-delay: calc(var(--curtain-stagger-delay) * 1);
}

.page-transition-exit .page-transition-overlay__panel:nth-child(5) {
    animation-delay: 0ms;
}

/* ==========================================================================
   Loading State
   Optional loading indicator during transition
   ========================================================================== */

.page-transition-overlay__loader {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) translateZ(0);
    width: 50px;
    height: 50px;
    opacity: 0;
    transition: opacity 300ms ease;
    
    /* GPU acceleration */
    backface-visibility: hidden;
    will-change: opacity;
}

.page-transition-overlay--active .page-transition-overlay__loader {
    opacity: 1;
    animation: loader-spin 1s linear infinite;
}

@keyframes loader-spin {
    from {
        transform: translate(-50%, -50%) rotate(0deg) translateZ(0);
    }
    to {
        transform: translate(-50%, -50%) rotate(360deg) translateZ(0);
    }
}

/* Loader ring style */
.page-transition-overlay__loader::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: 3px solid rgba(255, 255, 255, 0.2);
    border-top-color: #ffffff;
    border-radius: 50%;
}

/* ==========================================================================
   GPU Acceleration Utility Classes
   Requirements: 1.1-1.3 - Hardware acceleration
   ========================================================================== */

.page-transition-gpu-accelerated {
    transform: translateZ(0);
    backface-visibility: hidden;
    perspective: 1000px;
}

/* ==========================================================================
   Reduced Motion Support
   Requirements: 9.1-9.4 - Accessibility for motion sensitivity
   ========================================================================== */

@media (prefers-reduced-motion: reduce) {
    /* Disable all transition animations */
    .page-transition-overlay,
    .page-transition-overlay--liquid,
    .page-transition-overlay--curtain,
    .page-transition-overlay__panel {
        transition: none !important;
        animation: none !important;
    }
    
    /* Hide overlay completely - content shows immediately */
    .page-transition-overlay {
        display: none !important;
    }
    
    /* Remove will-change to save resources */
    .page-transition-overlay,
    .page-transition-overlay__panel,
    .page-transition-overlay__loader {
        will-change: auto !important;
    }
    
    /* Disable body scroll lock */
    .page-transition-active {
        overflow: auto !important;
    }
    
    .page-transition-active::before {
        display: none !important;
    }
}

/* ==========================================================================
   Responsive Adjustments
   Requirements: 10.1-10.4 - Mobile optimization
   ========================================================================== */

/* Tablet and below - reduce panel count visually */
@media (max-width: 1024px) {
    :root {
        --curtain-stagger-delay: 40ms;
    }
}

/* Mobile - faster transitions for better UX */
@media (max-width: 768px) {
    :root {
        --transition-duration: 600ms;
        --curtain-stagger-delay: 30ms;
    }
    
    /* Simpler gradient on mobile for performance */
    .page-transition-overlay--liquid {
        background: linear-gradient(
            135deg,
            var(--transition-color-blue) 0%,
            var(--transition-color-coral) 100%
        );
    }
}

/* Small mobile - even faster */
@media (max-width: 480px) {
    :root {
        --transition-duration: 500ms;
        --curtain-stagger-delay: 25ms;
    }
}

/* ==========================================================================
   High Contrast Mode Support
   ========================================================================== */

@media (prefers-contrast: high) {
    .page-transition-overlay--liquid {
        background: #000000;
    }
    
    .page-transition-overlay__panel {
        background: #000000 !important;
    }
}

/* ==========================================================================
   Print Styles
   ========================================================================== */

@media print {
    .page-transition-overlay,
    .page-transition-overlay--liquid,
    .page-transition-overlay--curtain {
        display: none !important;
    }
}
